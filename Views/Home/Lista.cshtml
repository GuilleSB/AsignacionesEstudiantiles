@using System.Globalization;

<style>

    @@media screen and (max-width: 1200px) {
        .btn {
            display: block;
            width: 100%;
            text-align: center;
        }
    }
</style>

<div class="row justify-content-center">
    <div class="col-md-10">
        <h2 class="h2">Lista de asignaciones</h2>
    </div>

    <div class="col-md-10">
        <form>
            <div class="row justify-content-between">

                <div class="d-flex flex-row align-items-center flex-wrap col-md-5 p-2">
                    <label for="fechaInicio">Fecha inicio: </label>
                    <input type="date" class="form-control" id="fechaInicio" value="@ViewBag.FechaInicio">
                </div>


                <div class="d-flex flex-row align-items-center flex-wrap col-md-5 p-2">
                    <label for="fechaFin">Fecha fin: </label>
                    <input type="date" class="form-control" id="fechaFin" value="@ViewBag.FechaFin">
                </div>
                <div class="d-flex flex-row align-items-center flex-wrap col-md-2 p-2">
                    <label></label>
                    <button type="button" id="btnFiltrar" class="btn btn-primary m-1 align-self-end">Filtrar</button>
                </div>
            </div>
            
        </form>
    </div>
</div>

<hr />

<div class="row justify-content-center mt-2">
    <div class="col-md-10">
        <div class="table-responsive">
            <table class="table table-striped table-responsive">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Asignacion</th>
                        <th>Estudiante</th>
                        <th>Ayudante</th>
                        <th>Descarga</th>
                    </tr>
                </thead>
                <tbody>

                    @{
                        CultureInfo ci = new CultureInfo("es-ES");
                        ci = new CultureInfo("es-ES");

                        foreach (var item in (List<HojitaModel>)ViewBag.Lista)
                        {
                                                <tr>
                                                    <td>@item.Fecha.ToString("dd MMM yyyy", ci)</td>
                                                    <td>@item.Asignacion</td>
                                                    <td>@item.Nombre</td>
                                                    <td>@item.Ayudante</td>
                                                    <td>
                                                        <a href="@Url.Action("Descargar","Home",new { id = item.Id })" class="btn btn-primary btn-sm m-1" style="text-decoration:none;color:white;">Descargar</a>
                                                        <a class="btn btn-danger btn-sm m-1" style="text-decoration:none;color:white;" onclick=confirmar('@item?.Id?.Trim()')>Eliminar</a>
                                                    </td>
                                                </tr>
                        }
                    }


                </tbody>
            </table>
        </div>


    </div>
</div>

@section Scripts {
    <script>

        function confirmar(idValue) {
            if (confirm("¿Seguro que desea eliminar este registro?")) {
                $.ajax({
                    url: "@Url.Action("Eliminar", "Home")?id=" + idValue,
                    method: "POST",
                    success: function (a) {
                        alert(a);
                        window.location.reload();
                    },
                    error: function (e) {
                        alert(e);
                    }
                });
            }
            return false;
        }

        window.onload = function (e) {

            // VALIDACION DE FECHAS.. PARA DESPUÉS
            // $("#fechaInicio").on("change", e => {
            //     e.preventDefault();

            //     var fechaIni = $("#fechaInicio").val();
            //     var fechaFin = $("#fechaFin").val();

            //     $.ajax({
            //         url: "@@Url.Action("CompararFechas","Home")?fechaInicio=" + fechaIni + "&fechaFin=" + fechaFin + "",
            //         method: "POST",
            //         success: function (response) {
            //             if (!response) {
            //                 alert("La fecha final debe ser mayor a la de inicio.");
            //                 return;
            //             }
            //         }
            //     });
            // });

            $("#btnFiltrar").click(e => {
                e.preventDefault();

                window.location.replace("@Url.Action("Lista","Home")?fechaInicio=" + $("#fechaInicio").val() + "&fechaFin=" + $("#fechaFin").val() + "");
            });

            
        }
    </script>
}

